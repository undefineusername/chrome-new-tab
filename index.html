<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ìƒˆ íƒ­</title>
<link rel="stylesheet" href="style.css">
</head>
<body>
<div class="main-container">
    <!-- ì™¼ìª½ ìš´ë™ íŒ¨ë„ -->
    <div class="side-panel workout-panel">
        <h3 class="panel-title">ì˜¤ëŠ˜ì˜ ìš´ë™</h3>
        
        <div class="workout-content">
            <!-- ìš´ë™ ë°ì´í„°ëŠ” JavaScriptì—ì„œ ë™ì  ìƒì„± -->
            <div id="workout-container"></div>
            
            <!-- ì£¼ë§ íœ´ì‹ -->
            <div class="rest-day" id="weekend-rest" style="display: none;">
                <h2>ğŸŒ™</h2>
                <h3>íœ´ì‹ì¼</h3>
                <p>ì¶©ë¶„í•œ íœ´ì‹ì„<br>ì·¨í•˜ì„¸ìš”</p>
            </div>
        </div>
        
        <!-- CD í”Œë ˆì´ì–´ ìœ„ì ¯ -->
        <div class="cd-player-widget" id="cd-player-widget" title="ìŒì•… í”Œë ˆì´ì–´">
            <div class="cd-container">
                <div class="cd-disc" id="cd-disc">
                    <div class="cd-center">
                        <div class="cd-hole"></div>
                        <div class="cd-label">
                            <div class="cd-title" id="cd-title">â™ª</div>
                        </div>
                    </div>
                    <div class="cd-reflection"></div>
                </div>
                <div class="cd-controls">
                    <button class="cd-btn" id="cd-prev-btn" onclick="previousTrack()">â®ï¸</button>
                    <button class="cd-btn cd-play-btn" id="cd-play-pause-btn" onclick="togglePlayPause()">â–¶ï¸</button>
                    <button class="cd-btn" id="cd-next-btn" onclick="nextTrack()">â­ï¸</button>
                </div>
            </div>
            <div class="cd-info">
                <div class="cd-track-info">
                    <span class="cd-track-title" id="cd-track-title">ìŒì•…ì„ ì„ íƒí•˜ì„¸ìš”</span>
                    <span class="cd-track-artist" id="cd-track-artist">ì•„í‹°ìŠ¤íŠ¸</span>
                </div>
                <div class="cd-progress">
                    <div class="cd-progress-bar">
                        <div class="cd-progress-fill" id="cd-progress-fill"></div>
                    </div>
                    <div class="cd-time">
                        <span id="cd-current-time">0:00</span>
                        <span id="cd-total-time">0:00</span>
                    </div>
                </div>
                <div class="cd-volume">
                    <span class="cd-volume-icon">ğŸ”Š</span>
                    <input type="range" class="cd-volume-slider" id="cd-volume-slider" min="0" max="100" value="50" onchange="changeVolume()">
                </div>
            </div>
            <input type="file" id="cd-music-file-input" accept="audio/*" style="display: none;" onchange="loadMusicFile(event)">
            <button class="cd-file-btn" onclick="document.getElementById('cd-music-file-input').click()">ğŸ“</button>
        </div>
        
        <!-- ë‚ ì”¨ ìœ„ì ¯ -->
        <div class="weather-widget" id="weather-widget" title="ë‚ ì”¨ ì •ë³´">
            <div class="weather-main">
                <span class="weather-icon" id="weather-icon">ğŸŒ¤ï¸</span>
                <span class="weather-temp" id="weather-temp">--Â°</span>
                <span class="weather-desc" id="weather-desc">ë¡œë”©ì¤‘...</span>
            </div>
            <div class="weather-details">
                <div class="weather-detail">
                    <span class="weather-detail-icon">ğŸ’§</span>
                    <span id="weather-humidity">--%</span>
                </div>
                <div class="weather-detail">
                    <span class="weather-detail-icon">ğŸ’¨</span>
                    <span id="weather-wind">-- m/s</span>
                </div>
                <div class="weather-detail">
                    <span class="weather-detail-icon">â˜ï¸</span>
                    <span id="weather-clouds">--%</span>
                </div>
                <div class="weather-detail">
                    <span class="weather-detail-icon">ğŸŒ¡ï¸</span>
                    <span id="weather-feels">--Â°</span>
                </div>
            </div>
        </div>
    </div>

    <!-- ì¤‘ì•™ ì„¹ì…˜ -->
    <div class="center-section">
        <div class="time-container">
            <div class="main-time" id="main-time">00:00</div>
            <div class="main-date" id="main-date">Loading...</div>
        </div>
        
        <div class="search-container">
            <input type="text" class="search-box" placeholder="Google ê²€ìƒ‰ ë˜ëŠ” URL ì…ë ¥" id="search-input">
            <button class="search-btn" onclick="performSearch()">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/>
                </svg>
            </button>
        </div>

        <!-- í¬ë¡¬ ìŠ¤íƒ€ì¼ ë°”ë¡œê°€ê¸° -->
        <div class="shortcuts-container">
            <div class="shortcuts-grid" id="shortcuts-grid">
                <!-- ë°”ë¡œê°€ê¸°ë“¤ì€ JavaScriptì—ì„œ ë™ì  ìƒì„± -->
            </div>
        </div>

        <!-- ì„¤ì • ë²„íŠ¼ -->
        <div class="settings-btn" onclick="toggleSettings()" title="ì„¤ì •">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                <path d="M12,15.5A3.5,3.5 0 0,1 8.5,12A3.5,3.5 0 0,1 12,8.5A3.5,3.5 0 0,1 15.5,12A3.5,3.5 0 0,1 12,15.5M19.43,12.97C19.47,12.65 19.5,12.33 19.5,12C19.5,11.67 19.47,11.34 19.43,11L21.54,9.37C21.73,9.22 21.78,8.95 21.66,8.73L19.66,5.27C19.54,5.05 19.27,4.96 19.05,5.05L16.56,6.05C16.04,5.66 15.5,5.32 14.87,5.07L14.5,2.42C14.46,2.18 14.25,2 14,2H10C9.75,2 9.54,2.18 9.5,2.42L9.13,5.07C8.5,5.32 7.96,5.66 7.44,6.05L4.95,5.05C4.73,4.96 4.46,5.05 4.34,5.27L2.34,8.73C2.22,8.95 2.27,9.22 2.46,9.37L4.57,11C4.53,11.34 4.5,11.67 4.5,12C4.5,12.33 4.53,12.65 4.57,12.97L2.46,14.63C2.27,14.78 2.22,15.05 2.34,15.27L4.34,18.73C4.46,18.95 4.73,19.03 4.95,18.95L7.44,17.94C7.96,18.34 8.5,18.68 9.13,18.93L9.5,21.58C9.54,21.82 9.75,22 10,22H14C14.25,22 14.46,21.82 14.5,21.58L14.87,18.93C15.5,18.68 16.04,18.34 16.56,17.94L19.05,18.95C19.27,19.03 19.54,18.95 19.66,18.73L21.66,15.27C21.78,15.05 21.73,14.78 21.54,14.63L19.43,12.97Z"/>
            </svg>
        </div>
    </div>

    <!-- ì˜¤ë¥¸ìª½ í• ì¼ íŒ¨ë„ -->
    <div class="side-panel todo-panel">
        <h3 class="panel-title">ì˜¤ëŠ˜ì˜ í• ì¼</h3>
        
        <div class="todo-input-container">
            <input type="text" class="todo-input" placeholder="í• ì¼ ì…ë ¥..." id="todo-input">
            <button class="add-btn" onclick="addTodo()">+</button>
        </div>
        
        <div class="todo-list" id="todo-list"></div>
    </div>
</div>

<!-- ë°”ë¡œê°€ê¸° ì¶”ê°€ ëª¨ë‹¬ -->
<div class="modal-overlay" id="add-shortcut-modal" onclick="hideAddShortcutModal()">
    <div class="modal-content" onclick="event.stopPropagation()">
        <h3>ë°”ë¡œê°€ê¸° ì¶”ê°€</h3>
        <div class="modal-form">
            <input type="text" id="shortcut-name" placeholder="ì‚¬ì´íŠ¸ ì´ë¦„" maxlength="10">
            <input type="url" id="shortcut-url" placeholder="https://example.com">
            <input type="text" id="shortcut-emoji" placeholder="ì´ëª¨ì§€ (ì˜ˆ: ğŸŒŸ)" maxlength="2">
            <div class="modal-buttons">
                <button onclick="hideAddShortcutModal()">ì·¨ì†Œ</button>
                <button onclick="addShortcut()" class="primary">ì¶”ê°€</button>
            </div>
        </div>
    </div>
</div>

<!-- ì„¤ì • íŒ¨ë„ -->
<div class="settings-panel" id="settings-panel">
    <div class="settings-header">
        <h3>ì„¤ì •</h3>
        <button onclick="toggleSettings()">Ã—</button>
    </div>
    <div class="settings-content">
        <div class="setting-item">
            <label>ë°°ê²½ í…Œë§ˆ</label>
            <select id="theme-select" onchange="changeTheme()">
                <option value="dark">ë‹¤í¬ ëª¨ë“œ</option>
                <option value="light">ë¼ì´íŠ¸ ëª¨ë“œ</option>
                <option value="auto">ì‹œìŠ¤í…œ ì„¤ì •</option>
            </select>
        </div>
        <div class="setting-item">
            <label>ê²€ìƒ‰ ì—”ì§„</label>
            <select id="search-engine" onchange="changeSearchEngine()">
                <option value="google">Google</option>
                <option value="bing">Bing</option>
                <option value="duckduckgo">DuckDuckGo</option>
                <option value="naver">Naver</option>
            </select>
        </div>
        <div class="setting-item">
            <label>ë‚ ì”¨ ìœ„ì¹˜</label>
            <input type="text" id="weather-location" placeholder="ë„ì‹œëª… (ì˜ˆ: Seoul)" onchange="changeWeatherLocation()">
        </div>
        <div class="setting-item">
            <label>ë°”ë¡œê°€ê¸° ê°œìˆ˜</label>
            <select id="shortcuts-count" onchange="changeShortcutsCount()">
                <option value="6">6ê°œ</option>
                <option value="8" selected>8ê°œ</option>
                <option value="10">10ê°œ</option>
                <option value="12">12ê°œ</option>
            </select>
        </div>
        <div class="setting-item">
            <button onclick="resetAllData()" class="danger-btn">ëª¨ë“  ë°ì´í„° ì´ˆê¸°í™”</button>
        </div>
    </div>
</div>

<script>
    // ì „ì—­ ë³€ìˆ˜ë“¤
    const state = {
        todos: JSON.parse(localStorage.getItem('todos')) || [],
        shortcuts: JSON.parse(localStorage.getItem('shortcuts')) || [],
        settings: JSON.parse(localStorage.getItem('settings')) || {
            theme: 'dark',
            searchEngine: 'google',
            weatherLocation: 'Ulsan,KR',
            shortcutsCount: 8
        },
        currentAudio: null,
        isPlaying: false,
        currentTrackIndex: 0,
        playlist: []
    };

    // ìš´ë™ ë°ì´í„°
    const workoutData = {
        'monday-workout': { name: 'ì›”ìš”ì¼', category: 'í•˜ì²´ & ì½”ì–´', exercises: [
            { name: 'ìŠ¤ì¿¼íŠ¸', reps: '3Ã—15' },
            { name: 'ëŸ°ì§€', reps: '3Ã—12' },
            { name: 'ê¸€ë£¨íŠ¸ ë¸Œë¦¬ì§€', reps: '3Ã—15' },
            { name: 'í”Œë­í¬', reps: '3Ã—30s' }
        ]},
        'tuesday-workout': { name: 'í™”ìš”ì¼', category: 'ìƒì²´ & ì½”ì–´', exercises: [
            { name: 'í‘¸ì‹œì—…', reps: '3Ã—12' },
            { name: 'ì¸ë²„í‹°ë“œ ë¡œìš°', reps: '3Ã—10' },
            { name: 'ìŠˆí¼ë§¨', reps: '3Ã—15' },
            { name: 'ì‚¬ì´ë“œ í”Œë­í¬', reps: '2Ã—30s' }
        ]},
        'wednesday-workout': { name: 'ìˆ˜ìš”ì¼', category: 'ì „ì‹  HIIT', exercises: [
            { name: 'ë²„í”¼', reps: '3Ã—10' },
            { name: 'ë§ˆìš´í‹´ í´ë¼ì´ë¨¸', reps: '3Ã—20' },
            { name: 'ì í•‘ ì­', reps: '3Ã—30s' },
            { name: 'í•˜ì´ ë‹ˆì¦ˆ', reps: '3Ã—20' }
        ]},
        'thursday-workout': { name: 'ëª©ìš”ì¼', category: 'í•˜ì²´ & ì½”ì–´', exercises: [
            { name: 'ìŠ¤ì¿¼íŠ¸', reps: '3Ã—15' },
            { name: 'ëŸ°ì§€', reps: '3Ã—12' },
            { name: 'ê¸€ë£¨íŠ¸ ë¸Œë¦¬ì§€', reps: '3Ã—15' },
            { name: 'í”Œë­í¬', reps: '3Ã—30s' }
        ]},
        'friday-workout': { name: 'ê¸ˆìš”ì¼', category: 'ìƒì²´ & ì½”ì–´', exercises: [
            { name: 'í‘¸ì‹œì—…', reps: '3Ã—12' },
            { name: 'ì¸ë²„í‹°ë“œ ë¡œìš°', reps: '3Ã—10' },
            { name: 'ìŠˆí¼ë§¨', reps: '3Ã—15' },
            { name: 'ì‚¬ì´ë“œ í”Œë­í¬', reps: '2Ã—30s' }
        ]}
    };

    // ê¸°ë³¸ ë°”ë¡œê°€ê¸° ë°ì´í„°
    const defaultShortcuts = [
        { name: 'YouTube', url: 'https://www.youtube.com', emoji: 'ğŸ“º', color: '#ff0000' },
        { name: 'GitHub', url: 'https://github.com/undefineusername', emoji: 'ğŸ™', color: '#333333' },
        { name: 'Gmail', url: 'https://www.gmail.com', emoji: 'ğŸ“§', color: '#ea4335' },
        { name: 'Discord', url: 'https://discord.com/channels/@me', emoji: 'ğŸ’¬', color: '#5865f2' }
    ];

    // ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ë“¤
    const utils = {
        formatTime: (seconds) => {
            const minutes = Math.floor(seconds / 60);
            const remainingSeconds = Math.floor(seconds % 60);
            return `${minutes}:${remainingSeconds.toString().padStart(2, '0')}`;
        },
        
        getRandomColor: () => {
            const colors = ['#ff6b6b', '#4ecdc4', '#45b7d1', '#96ceb4', '#feca57', '#ff9ff3', '#54a0ff', '#5f27cd'];
            return colors[Math.floor(Math.random() * colors.length)];
        },

        getWeatherIcon: (main) => {
            const iconMap = {
                'Clear': 'â˜€ï¸', 'Clouds': 'ğŸŒ¥ï¸', 'Rain': 'ğŸŒ§ï¸', 'Drizzle': 'ğŸŒ¦ï¸',
                'Thunderstorm': 'â›ˆï¸', 'Snow': 'â„ï¸', 'Mist': 'ğŸŒ«ï¸', 'Fog': 'ğŸŒ«ï¸', 'Haze': 'ğŸŒ«ï¸'
            };
            return iconMap[main] || 'ğŸŒ¤ï¸';
        },

        saveToStorage: (key, data) => localStorage.setItem(key, JSON.stringify(data)),
        
        getFromStorage: (key, defaultValue = null) => {
            try {
                return JSON.parse(localStorage.getItem(key)) || defaultValue;
            } catch {
                return defaultValue;
            }
        }
    };

    // ì‹œê°„ ì—…ë°ì´íŠ¸
    function updateTime() {
        const now = new Date();
        const timeString = now.toLocaleTimeString('ko-KR', { hour12: true, hour: '2-digit', minute: '2-digit' });
        const dateString = now.toLocaleDateString('ko-KR', { year: 'numeric', month: 'long', day: 'numeric', weekday: 'long' });
        
        document.getElementById('main-time').textContent = timeString;
        document.getElementById('main-date').textContent = dateString;
    }

    // ë‚ ì”¨ ê¸°ëŠ¥
    const weather = {
        API_KEY: "8adb134e958c5708f199d69cde65b942",
        
        getUrl: () => `https://api.openweathermap.org/data/2.5/weather?q=${state.settings.weatherLocation}&appid=${weather.API_KEY}&units=metric&lang=kr`,
        
        async fetch() {
            const cached = utils.getFromStorage('weather_cache', {});
            const now = Date.now();

            if (cached.timestamp && now - cached.timestamp < 10 * 60 * 1000) {
                this.display(cached.data);
                return;
            }

            try {
                const res = await fetch(this.getUrl());
                if (!res.ok) throw new Error("API ì‘ë‹µ ì˜¤ë¥˜");
                const data = await res.json();
                
                utils.saveToStorage('weather_cache', { data, timestamp: now });
                this.display(data);
            } catch (e) {
                console.error("ë‚ ì”¨ ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨:", e);
                document.getElementById('weather-temp').textContent = 'ì˜¤ë¥˜';
                document.getElementById('weather-desc').textContent = 'ë‚ ì”¨ ì •ë³´ ì—†ìŒ';
            }
        },

        display(data) {
            const elements = {
                icon: document.getElementById('weather-icon'),
                temp: document.getElementById('weather-temp'),
                desc: document.getElementById('weather-desc'),
                humidity: document.getElementById('weather-humidity'),
                wind: document.getElementById('weather-wind'),
                clouds: document.getElementById('weather-clouds'),
                feels: document.getElementById('weather-feels')
            };

            elements.icon.textContent = utils.getWeatherIcon(data.weather[0].main);
            elements.temp.textContent = Math.round(data.main.temp) + 'Â°';
            elements.desc.textContent = data.weather[0].description;
            elements.humidity.textContent = data.main.humidity + '%';
            elements.wind.textContent = data.wind.speed + ' m/s';
            elements.clouds.textContent = data.clouds.all + '%';
            elements.feels.textContent = Math.round(data.main.feels_like) + 'Â°';
        }
    };

    // MP3 í”Œë ˆì´ì–´ ê¸°ëŠ¥
    const musicPlayer = {
        loadFile(event) {
            const file = event.target.files[0];
            if (!file || !file.type.startsWith('audio/')) return;

            if (state.currentAudio) state.currentAudio.pause();
            
            const url = URL.createObjectURL(file);
            state.currentAudio = new Audio(url);
            
            const fileName = file.name.replace(/\.[^/.]+$/, "");
            document.getElementById('cd-track-title').textContent = fileName;
            document.getElementById('cd-track-artist').textContent = 'ë¡œì»¬ íŒŒì¼';
            
            state.currentAudio.addEventListener('loadedmetadata', () => {
                document.getElementById('cd-total-time').textContent = utils.formatTime(state.currentAudio.duration);
            });
            
            state.currentAudio.addEventListener('timeupdate', this.updateProgress);
            state.currentAudio.addEventListener('ended', () => nextTrack());
            
            state.currentAudio.volume = document.getElementById('cd-volume-slider').value / 100;
        },

        updateProgress() {
            if (!state.currentAudio) return;
            
            const progress = (state.currentAudio.currentTime / state.currentAudio.duration) * 100;
            document.getElementById('cd-progress-fill').style.width = progress + '%';
            document.getElementById('cd-current-time').textContent = utils.formatTime(state.currentAudio.currentTime);
        }
    };

    // ìš´ë™ ê¸°ëŠ¥
    const workout = {
        render() {
            const container = document.getElementById('workout-container');
            container.innerHTML = '';

            Object.entries(workoutData).forEach(([id, data]) => {
                const workoutDiv = document.createElement('div');
                workoutDiv.className = 'workout-day';
                workoutDiv.id = id;
                workoutDiv.style.display = 'none';
                
                workoutDiv.innerHTML = `
                    <div class="day-info">
                        <div class="day-name">${data.name}</div>
                        <div class="day-category">${data.category}</div>
                    </div>
                    <ul class="exercise-list">
                        ${data.exercises.map(exercise => `
                            <li class="exercise-item">
                                <input type="checkbox" class="exercise-checkbox" onchange="updateProgress()">
                                <span class="exercise-name">${exercise.name}</span>
                                <span class="exercise-reps">${exercise.reps}</span>
                            </li>
                        `).join('')}
                    </ul>
                    <div class="progress-bar">
                        <div class="progress-fill"></div>
                    </div>
                    <div class="progress-text">0%</div>
                `;
                
                container.appendChild(workoutDiv);
            });
        },

        showToday() {
            const today = new Date().getDay();
            const workoutDays = ['weekend-rest', 'monday-workout', 'tuesday-workout', 'wednesday-workout', 'thursday-workout', 'friday-workout', 'weekend-rest'];
            
            document.querySelectorAll('.workout-day, .rest-day').forEach(card => {
                card.style.display = 'none';
            });
            
            const todayWorkout = document.getElementById(workoutDays[today]);
            if (todayWorkout) {
                todayWorkout.style.display = 'block';
                updateProgress();
            }
        }
    };

    // ë°”ë¡œê°€ê¸° ê¸°ëŠ¥
    const shortcuts = {
        render() {
            const grid = document.getElementById('shortcuts-grid');
            grid.innerHTML = '';

            // ê¸°ë³¸ ë°”ë¡œê°€ê¸°ë“¤
            defaultShortcuts.forEach(shortcut => {
                const element = this.createElement(shortcut, true);
                grid.appendChild(element);
            });

            // ì‚¬ìš©ì ë°”ë¡œê°€ê¸°ë“¤
            state.shortcuts.forEach(shortcut => {
                const element = this.createElement(shortcut, false);
                grid.appendChild(element);
            });

            // ì¶”ê°€ ë²„íŠ¼
            const addButton = document.createElement('div');
            addButton.className = 'shortcut-item add-shortcut';
            addButton.onclick = showAddShortcutModal;
            addButton.innerHTML = `
                <div class="shortcut-icon add-icon"><span>+</span></div>
                <span class="shortcut-name">ì¶”ê°€</span>
            `;
            grid.appendChild(addButton);
        },

        createElement(shortcut, isDefault) {
            const element = document.createElement('div');
            element.className = 'shortcut-item';
            if (isDefault) element.classList.add('default-shortcut');
            if (!isDefault) element.dataset.id = shortcut.id;
            element.onclick = () => window.open(shortcut.url, '_blank');
            
            element.innerHTML = `
                <div class="shortcut-icon" style="background-color: ${shortcut.color};">
                    <span>${shortcut.emoji}</span>
                </div>
                <span class="shortcut-name">${shortcut.name}</span>
                ${!isDefault ? '<button class="shortcut-delete" onclick="event.stopPropagation(); deleteShortcut(this)">Ã—</button>' : ''}
            `;
            
            return element;
        }
    };

    // í• ì¼ ê¸°ëŠ¥
    const todos = {
        render() {
            const todoList = document.getElementById('todo-list');
            todoList.innerHTML = '';
            
            state.todos.forEach(todo => {
                const todoItem = document.createElement('div');
                todoItem.className = `todo-item ${todo.completed ? 'completed' : ''}`;
                
                todoItem.innerHTML = `
                    <input type="checkbox" class="todo-checkbox" ${todo.completed ? 'checked' : ''} 
                           onchange="toggleTodo(${todo.id})">
                    <span class="todo-text">${todo.text}</span>
                    <button class="delete-btn" onclick="deleteTodo(${todo.id})">Ã—</button>
                `;
                
                todoList.appendChild(todoItem);
            });
        },

        add() {
            const input = document.getElementById('todo-input');
            const text = input.value.trim();
            
            if (text) {
                const todo = { id: Date.now(), text, completed: false };
                state.todos.push(todo);
                utils.saveToStorage('todos', state.todos);
                this.render();
                input.value = '';
            }
        },

        toggle(id) {
            state.todos = state.todos.map(todo => 
                todo.id === id ? { ...todo, completed: !todo.completed } : todo
            );
            utils.saveToStorage('todos', state.todos);
            this.render();
        },

        delete(id) {
            state.todos = state.todos.filter(todo => todo.id !== id);
            utils.saveToStorage('todos', state.todos);
            this.render();
        }
    };

    // ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ë“¤
    function loadMusicFile(event) { musicPlayer.loadFile(event); }
    
    function togglePlayPause() {
        if (!state.currentAudio) {
            alert('ë¨¼ì € ìŒì•… íŒŒì¼ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
            return;
        }
        
        const cdDisc = document.getElementById('cd-disc');
        const playBtn = document.getElementById('cd-play-pause-btn');
        
        if (state.isPlaying) {
            state.currentAudio.pause();
            playBtn.textContent = 'â–¶ï¸';
            cdDisc.classList.remove('spinning');
            state.isPlaying = false;
        } else {
            state.currentAudio.play();
            playBtn.textContent = 'â¸ï¸';
            cdDisc.classList.add('spinning');
            state.isPlaying = true;
        }
    }

    function previousTrack() {
        if (state.currentAudio) state.currentAudio.currentTime = 0;
    }

    function nextTrack() {
        if (state.currentAudio) {
            state.currentAudio.currentTime = 0;
            if (state.isPlaying) state.currentAudio.play();
        }
    }

    function changeVolume() {
        const volume = document.getElementById('cd-volume-slider').value / 100;
        if (state.currentAudio) state.currentAudio.volume = volume;
    }

    function updateProgress() {
        const visibleCard = document.querySelector('.workout-day[style*="block"]');
        if (!visibleCard) return;
        
        const checkboxes = visibleCard.querySelectorAll('.exercise-checkbox');
        const checkedBoxes = visibleCard.querySelectorAll('.exercise-checkbox:checked');
        const progress = Math.round((checkedBoxes.length / checkboxes.length) * 100);
        
        const progressFill = visibleCard.querySelector('.progress-fill');
        const progressText = visibleCard.querySelector('.progress-text');
        
        if (progressFill) progressFill.style.width = progress + '%';
        if (progressText) progressText.textContent = progress + '%';
        
        checkboxes.forEach(checkbox => {
            const exerciseItem = checkbox.closest('.exercise-item');
            exerciseItem.classList.toggle('completed', checkbox.checked);
        });
    }

    function performSearch() {
        const query = document.getElementById('search-input').value.trim();
        if (!query) return;

        const searchEngines = {
            google: `https://www.google.com/search?q=${encodeURIComponent(query)}`,
            bing: `https://www.bing.com/search?q=${encodeURIComponent(query)}`,
            duckduckgo: `https://duckduckgo.com/?q=${encodeURIComponent(query)}`,
            naver: `https://search.naver.com/search.naver?query=${encodeURIComponent(query)}`
        };

        const url = query.includes('.') && !query.includes(' ') 
            ? (query.startsWith('http') ? query : 'https://' + query)
            : searchEngines[state.settings.searchEngine] || searchEngines.google;
            
        window.location.href = url;
    }

    function showAddShortcutModal() {
        document.getElementById('add-shortcut-modal').style.display = 'flex';
        document.getElementById('shortcut-name').focus();
    }

    function hideAddShortcutModal() {
        document.getElementById('add-shortcut-modal').style.display = 'none';
        ['shortcut-name', 'shortcut-url', 'shortcut-emoji'].forEach(id => {
            document.getElementById(id).value = '';
        });
    }

    function addShortcut() {
        const name = document.getElementById('shortcut-name').value.trim();
        const url = document.getElementById('shortcut-url').value.trim();
        const emoji = document.getElementById('shortcut-emoji').value.trim() || 'ğŸŒ';

        if (!name || !url) {
            alert('ì´ë¦„ê³¼ URLì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.');
            return;
        }

        const shortcut = { id: Date.now(), name, url, emoji, color: utils.getRandomColor() };
        state.shortcuts.push(shortcut);
        utils.saveToStorage('shortcuts', state.shortcuts);
        shortcuts.render();
        hideAddShortcutModal();
    }

    function deleteShortcut(button) {
        const shortcutId = parseInt(button.closest('.shortcut-item').dataset.id);
        state.shortcuts = state.shortcuts.filter(s => s.id !== shortcutId);
        utils.saveToStorage('shortcuts', state.shortcuts);
        shortcuts.render();
    }

    function addTodo() { todos.add(); }
    function toggleTodo(id) { todos.toggle(id); }
    function deleteTodo(id) { todos.delete(id); }

    function toggleSettings() {
        document.getElementById('settings-panel').classList.toggle('active');
    }

    function changeTheme() {
        state.settings.theme = document.getElementById('theme-select').value;
        utils.saveToStorage('settings', state.settings);
        applyTheme();
    }

    function applyTheme() {
        const body = document.body;
        if (state.settings.theme === 'light') {
            body.classList.add('light-theme');
        } else if (state.settings.theme === 'dark') {
            body.classList.remove('light-theme');
        } else {
            const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
            body.classList.toggle('light-theme', !prefersDark);
        }
    }

    function changeSearchEngine() {
        state.settings.searchEngine = document.getElementById('search-engine').value;
        utils.saveToStorage('settings', state.settings);
    }

    function changeWeatherLocation() {
        const location = document.getElementById('weather-location').value.trim();
        if (location) {
            state.settings.weatherLocation = location;
            utils.saveToStorage('settings', state.settings);
            localStorage.removeItem('weather_cache');
            weather.fetch();
        }
    }

    function changeShortcutsCount() {
        state.settings.shortcutsCount = parseInt(document.getElementById('shortcuts-count').value);
        utils.saveToStorage('settings', state.settings);
        updateShortcutsGrid();
    }

    function updateShortcutsGrid() {
        const grid = document.getElementById('shortcuts-grid');
        grid.style.gridTemplateColumns = `repeat(${Math.min(state.settings.shortcutsCount, 6)}, 1fr)`;
    }

    function resetAllData() {
        if (confirm('ëª¨ë“  ë°ì´í„°ë¥¼ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ? ì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.')) {
            localStorage.clear();
            location.reload();
        }
    }

    function loadSettings() {
        document.getElementById('theme-select').value = state.settings.theme;
        document.getElementById('search-engine').value = state.settings.searchEngine;
        document.getElementById('weather-location').value = state.settings.weatherLocation.split(',')[0];
        document.getElementById('shortcuts-count').value = state.settings.shortcutsCount;
        
        applyTheme();
        updateShortcutsGrid();
    }

    // í‚¤ë³´ë“œ ì´ë²¤íŠ¸
    document.addEventListener('keydown', (e) => {
        if (e.ctrlKey && e.key === 'k') {
            e.preventDefault();
            document.getElementById('search-input').focus();
        }
        
        if (e.ctrlKey && e.shiftKey && e.key === 'S') {
            e.preventDefault();
            toggleSettings();
        }
        
        if (e.code === 'Space' && e.target.tagName !== 'INPUT') {
            e.preventDefault();
            togglePlayPause();
        }
        
        if (e.key === 'Escape') {
            hideAddShortcutModal();
            const settingsPanel = document.getElementById('settings-panel');
            if (settingsPanel.classList.contains('active')) {
                toggleSettings();
            }
        }
    });

    // Enter í‚¤ ì´ë²¤íŠ¸ë“¤
    ['search-input', 'todo-input'].forEach(id => {
        document.getElementById(id).addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                if (id === 'search-input') performSearch();
                else addTodo();
            }
        });
    });

    // ë°”ë¡œê°€ê¸° ëª¨ë‹¬ Enter í‚¤ ì²´ì¸
    const modalInputs = ['shortcut-name', 'shortcut-url', 'shortcut-emoji'];
    modalInputs.forEach((id, index) => {
        document.getElementById(id).addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                if (index < modalInputs.length - 1) {
                    document.getElementById(modalInputs[index + 1]).focus();
                } else {
                    addShortcut();
                }
            }
        });
    });

    // ì´ˆê¸°í™”
    window.addEventListener('load', () => {
        updateTime();
        weather.fetch();
        workout.render();
        workout.showToday();
        todos.render();
        shortcuts.render();
        loadSettings();
        
        setInterval(updateTime, 1000);
    });
</script>
</body>
</html>
